{
  "openapi": "3.0.0",
  "info": {
    "title": "Forni API",
    "description": "API for the Forni bakery surplus bag platform",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://localhost:5000/api",
      "description": "Development server"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  },
  "paths": {
    "/auth/register": {
      "post": {
        "tags": ["Authentication"],
        "summary": "Register a new user",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {"type": "string", "format": "email"},
                  "password": {"type": "string", "minLength": 8},
                  "first_name": {"type": "string"},
                  "last_name": {"type": "string"},
                  "phone": {"type": "string"},
                  "role": {"type": "string", "enum": ["customer", "bakery_owner"]}
                },
                "required": ["email", "password", "first_name", "last_name", "phone"]
              }
            }
          }
        },
        "responses": {
          "201": {"description": "User created successfully"},
          "400": {"description": "Invalid input"},
          "409": {"description": "User already exists"}
        }
      }
    },
    "/auth/login": {
      "post": {
        "tags": ["Authentication"],
        "summary": "Login user",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {"type": "string", "format": "email"},
                  "password": {"type": "string"}
                },
                "required": ["email", "password"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "access_token": {"type": "string"},
                    "refresh_token": {"type": "string"},
                    "user": {"type": "object"}
                  }
                }
              }
            }
          },
          "401": {"description": "Invalid credentials"}
        }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": ["Authentication"],
        "summary": "Logout user",
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {"description": "Logout successful"},
          "401": {"description": "Unauthorized"}
        }
      }
    },
    "/auth/refresh": {
      "post": {
        "tags": ["Authentication"],
        "summary": "Refresh access token",
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {
            "description": "Token refreshed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "access_token": {"type": "string"}
                  }
                }
              }
            }
          },
          "401": {"description": "Unauthorized"}
        }
      }
    },
    "/auth/profile": {
      "get": {
        "tags": ["Authentication"],
        "summary": "Get current user profile",
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {
            "description": "User profile",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          },
          "401": {"description": "Unauthorized"}
        }
      }
    },
    "/products": {
      "get": {
        "tags": ["Products"],
        "summary": "Get all products",
        "responses": {
          "200": {
            "description": "List of products",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {"type": "object"}
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Products"],
        "summary": "Create a new product",
        "security": [{"bearerAuth": []}],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {"type": "string"},
                  "description": {"type": "string"},
                  "price": {"type": "number"},
                  "bakery_id": {"type": "integer"}
                },
                "required": ["name", "price", "bakery_id"]
              }
            }
          }
        },
        "responses": {
          "201": {"description": "Product created"},
          "401": {"description": "Unauthorized"}
        }
      }
    },
    "/products/{product_id}": {
      "get": {
        "tags": ["Products"],
        "summary": "Get product by ID",
        "parameters": [
          {
            "name": "product_id",
            "in": "path",
            "required": true,
            "schema": {"type": "integer"}
          }
        ],
        "responses": {
          "200": {"description": "Product details"},
          "404": {"description": "Product not found"}
        }
      },
      "put": {
        "tags": ["Products"],
        "summary": "Update product",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {
            "name": "product_id",
            "in": "path",
            "required": true,
            "schema": {"type": "integer"}
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {"type": "string"},
                  "description": {"type": "string"},
                  "price": {"type": "number"}
                }
              }
            }
          }
        },
        "responses": {
          "200": {"description": "Product updated"},
          "401": {"description": "Unauthorized"},
          "404": {"description": "Product not found"}
        }
      },
      "delete": {
        "tags": ["Products"],
        "summary": "Delete product",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {
            "name": "product_id",
            "in": "path",
            "required": true,
            "schema": {"type": "integer"}
          }
        ],
        "responses": {
          "200": {"description": "Product deleted"},
          "401": {"description": "Unauthorized"},
          "404": {"description": "Product not found"}
        }
      }
    },
    "/orders": {
      "get": {
        "tags": ["Orders"],
        "summary": "Get user orders",
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {
            "description": "List of orders",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {"type": "object"}
                }
              }
            }
          },
          "401": {"description": "Unauthorized"}
        }
      },
      "post": {
        "tags": ["Orders"],
        "summary": "Create a new order",
        "security": [{"bearerAuth": []}],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "items": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "product_id": {"type": "integer"},
                        "quantity": {"type": "integer"}
                      }
                    }
                  }
                },
                "required": ["items"]
              }
            }
          }
        },
        "responses": {
          "201": {"description": "Order created"},
          "401": {"description": "Unauthorized"}
        }
      }
    },
    "/orders/{order_id}": {
      "get": {
        "tags": ["Orders"],
        "summary": "Get order by ID",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {
            "name": "order_id",
            "in": "path",
            "required": true,
            "schema": {"type": "integer"}
          }
        ],
        "responses": {
          "200": {"description": "Order details"},
          "401": {"description": "Unauthorized"},
          "404": {"description": "Order not found"}
        }
      }
    },
    "/reviews": {
      "get": {
        "tags": ["Reviews"],
        "summary": "Get all reviews",
        "responses": {
          "200": {
            "description": "List of reviews",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {"type": "object"}
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Reviews"],
        "summary": "Create a review",
        "security": [{"bearerAuth": []}],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "product_id": {"type": "integer"},
                  "rating": {"type": "number", "minimum": 1, "maximum": 5},
                  "comment": {"type": "string"}
                },
                "required": ["product_id", "rating"]
              }
            }
          }
        },
        "responses": {
          "201": {"description": "Review created"},
          "401": {"description": "Unauthorized"}
        }
      }
    },
    "/reviews/{review_id}": {
      "get": {
        "tags": ["Reviews"],
        "summary": "Get review by ID",
        "parameters": [
          {
            "name": "review_id",
            "in": "path",
            "required": true,
            "schema": {"type": "integer"}
          }
        ],
        "responses": {
          "200": {"description": "Review details"},
          "404": {"description": "Review not found"}
        }
      }
    },
    "/bakery": {
      "get": {
        "tags": ["Bakeries"],
        "summary": "List all bakeries",
        "responses": {
          "200": {"description": "List of bakeries"}
        }
      },
      "post": {
        "tags": ["Bakeries"],
        "summary": "Create bakery (owner/admin)",
        "security": [{"bearerAuth": []}],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {"type": "string"},
                  "address": {"type": "string"},
                  "description": {"type": "string"}
                }
              }
            }
          }
        },
        "responses": {
          "201": {"description": "Bakery created"},
          "401": {"description": "Unauthorized"}
        }
      }
    },
    "/bakery/{bakery_id}": {
      "get": {
        "tags": ["Bakeries"],
        "summary": "Get bakery by ID",
        "parameters": [
          {"name": "bakery_id", "in": "path", "required": true, "schema": {"type": "integer"}}
        ],
        "responses": {
          "200": {"description": "Bakery details"}
        }
      },
      "put": {
        "tags": ["Bakeries"],
        "summary": "Update bakery (owner/admin)",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {"name": "bakery_id", "in": "path", "required": true, "schema": {"type": "integer"}}
        ],
        "responses": {
          "200": {"description": "Bakery updated"}
        }
      },
      "delete": {
        "tags": ["Bakeries"],
        "summary": "Delete bakery (admin)",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {"name": "bakery_id", "in": "path", "required": true, "schema": {"type": "integer"}}
        ],
        "responses": {
          "200": {"description": "Bakery deleted"}
        }
      }
    },
    "/surplus_bag": {
      "get": {
        "tags": ["Surplus Bags"],
        "summary": "List all surplus bags",
        "responses": {
          "200": {"description": "List of surplus bags"}
        }
      },
      "post": {
        "tags": ["Surplus Bags"],
        "summary": "Create surplus bag (owner/admin)",
        "security": [{"bearerAuth": []}],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "bakery_id": {"type": "integer"},
                  "description": {"type": "string"},
                  "original_value": {"type": "number"},
                  "sale_price": {"type": "number"},
                  "quantity": {"type": "integer"}
                }
              }
            }
          }
        },
        "responses": {
          "201": {"description": "Surplus bag created"}
        }
      }
    },
    "/surplus_bag/{surplus_bag_id}": {
      "get": {
        "tags": ["Surplus Bags"],
        "summary": "Get surplus bag by ID",
        "parameters": [
          {"name": "surplus_bag_id", "in": "path", "required": true, "schema": {"type": "integer"}}
        ],
        "responses": {
          "200": {"description": "Surplus bag details"}
        }
      },
      "put": {
        "tags": ["Surplus Bags"],
        "summary": "Update surplus bag (owner/admin)",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {"name": "surplus_bag_id", "in": "path", "required": true, "schema": {"type": "integer"}}
        ],
        "responses": {
          "200": {"description": "Surplus bag updated"}
        }
      },
      "delete": {
        "tags": ["Surplus Bags"],
        "summary": "Delete surplus bag (owner/admin)",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {"name": "surplus_bag_id", "in": "path", "required": true, "schema": {"type": "integer"}}
        ],
        "responses": {
          "200": {"description": "Surplus bag deleted"}
        }
      }
    },
    "/recommendation": {
      "get": {
        "tags": ["Recommendations"],
        "summary": "Get personalized recommendations",
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {"description": "Recommended surplus bags"}
        }
      }
    },
    "/waste-prevented": {
      "get": {
        "tags": ["Analytics"],
        "summary": "Get total waste prevented analytics",
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {"description": "Total waste prevented value"}
        }
      }
    },
    "/profile": {
      "get": {
        "tags": ["Users"],
        "summary": "Get current user profile",
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {"description": "User profile"}
        }
      },
      "put": {
        "tags": ["Users"],
        "summary": "Update current user profile",
        "security": [{"bearerAuth": []}],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "first_name": {"type": "string"},
                  "last_name": {"type": "string"},
                  "phone": {"type": "string"},
                  "latitude": {"type": "number"},
                  "longitude": {"type": "number"}
                }
              }
            }
          }
        },
        "responses": {
          "200": {"description": "Profile updated"}
        }
      }
    }
  }
}
